---
title: Azure 和 Azure Stack Hub 中的混合式應用程式設計考量
description: 了解為智慧型雲端和智慧邊緣建置混合式應用程式時的設計考量，包括放置、延展性、可用性和復原能力。
author: BryanLa
ms.topic: article
ms.date: 06/07/2020
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 11/05/2019
ms.openlocfilehash: 4fd52f76baad8059e130adfc01cdd0152b40a510
ms.sourcegitcommit: bb3e40b210f86173568a47ba18c3cc50d4a40607
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/17/2020
ms.locfileid: "84910118"
---
# <a name="hybrid-app-design-considerations"></a>混合式應用程式設計考量

Microsoft Azure 是唯一的一致性混合式雲端。 其可讓您重複運用您的開發投資，並且讓應用程式能夠跨越全域 Azure、Azure 主權雲端和 Azure Stack (此為資料中心的 Azure 延伸模組之一)。 跨雲端應用程式也稱為*混合式應用程式*。

[*Azure 應用程式架構指南*](https://docs.microsoft.com/azure/architecture/guide)說明設定可擴充、可復原和高可用性應用程式的結構化方法。 [*Azure 應用程式架構指南*](https://docs.microsoft.com/azure/architecture/guide)中說明的考量事項，同樣適用於針對單一雲端而設計的應用程式和跨雲端的應用程式。

本文增補了 [*Azure 應用程式*](https://docs.microsoft.com/azure/architecture/guide/) [*架構指南*](https://docs.microsoft.com/azure/architecture/guide/)中討論的[*軟體品質的要素*](https://docs.microsoft.com/azure/architecture/guide/pillars)，主要著重於設計混合式應用程式的說明。 此外，我們也新增了*位置*要素，因為混合式應用程式並非專屬於一個雲端或一個內部部署資料中心。

混合式案例依開發時可使用的資源而有很大的差異，可供程式開發，同時需一併考量像是地理位置、安全性、網際網路存取權，以及其他因素。 雖然本指南無法列舉您特有的考量，但可提供一些重要的指導方針和最佳做法供您依循。 要成功設計、設定、部署和維護混合式應用程式架構，牽涉到許多可能不為您所熟知的設計考量。

本文件將彙總在執行混合式應用程式時可能發生的問題，並提供相關考量事項 (這些要素) 和最佳做法來加以處理。 藉由在設計階段解決這些問題，將可避免其在生產環境中可能造成的問題。

基本上，這些都是您在建立混合式應用程式之前必須考量的問題。 若要開始，您必須執行下列動作：

- 識別並評估應用程式元件。
- 根據要素評估應用程式元件。

## <a name="evaluate-the-app-components"></a>評估應用程式元件

應用程式的每個元件在較大的應用程式內都有其本身的特定角色，且應使用所有設計考量來加以檢查。 每個元件的需求和功能都應符合這些考量，以利判斷應用程式架構。

您可以研究應用程式的架構並判斷其組成內容，藉以將應用程式分解成其元件。 元件也可以包含與您的應用程式互動的其他應用程式。 當您識別元件時，請提出下列問題，以根據其特性評估您想要的混合式作業：

- 元件的用途為何？
- 元件之間有哪些相互依存性？

例如，應用程式可以有定義為兩個元件的前端和後端。 在混合式案例中，前端位於一個雲端中，後端則位於另一個雲端。 應用程式可提供前端與使用者之間，以及前端與後端之間的通訊管道。

應用程式元件由許多形式和案例所定義。 最重要的工作是識別元件及其雲端或內部部署位置。

表 1 列出要包含在清查中的常見應用程式元件。

### <a name="table-1-common-app-components"></a>表 1. 常見應用程式元件

| **元件** | **混合式應用程式指引** |
| ---- | ---- |
| 用戶端連接 | 您的應用程式 (在任何裝置上) 可以從單一進入點用各種方式存取使用者，包括下列方式：<br>- 使用者必須安裝用戶端才能使用應用程式的用戶端伺服器模型。 以伺服器為基礎、可從瀏覽器存取的應用程式。<br>- 用戶端連線可以包含連線中斷時的通知，或可能適用漫遊費用時的警示。 |
| 驗證  | 連線至應用程式的使用者，或從某個元件連線至另一個元件的使用者，都可能需要進行驗證。 |
| API  | 您可以讓開發人員以程式設計方式使用 API 集合和類別庫來存取您的應用程式，並根據網際網路標準提供連線介面。 您也可以使用 API 將應用程式分解成獨立運作的邏輯單元。 |
| 服務  | 您可以使用簡單的服務來提供應用程式的功能。 此類服務可以是應用程式執行所在的引擎。 |
| 佇列 | 您可以使用佇列來組織生命週期的狀態，以及應用程式元件的狀態。 這些佇列可為訂閱者提供傳訊、通知和緩衝處理功能。 |
| 資料儲存體 | 應用程式可以是無狀態或具狀態的。 具狀態應用程式需要多種格式和磁碟區皆可符合的資料儲存體。 |
| 資料快取  | 設計中的資料快取元件可以策略性地解決延遲問題，並扮演觸發雲端負載平衡的角色。 |
| 資料擷取 | 資料可透過許多方式提交至應用程式，舉凡 Web 表單中的使用者提交值，到持續性的大量資料流程，都包含在內。 |
| 資料處理 | 您的資料處理工作 (例如報表、分析、批次匯出和資料轉換) 可以在來源處理，或使用資料複本在個別元件上卸載。 |

## <a name="assess-app-components-for-pillars"></a>評估應用程式元件的要素

針對每個元件，請評估其每個要素的特性。 當您評估每個元件的各項要素時，您可能得以認清某些未考量到的問題將對混合式應用程式的設計造成影響。 進行這些考量有助於應用程式的最佳化。 表 2 說明每項要素與混合式應用程式的關聯性。

### <a name="table-2-pillars"></a>表 2. 要素

| **要素** | **說明** |
| ----------- | --------------------------------------------------------- |
| 放置  | 元件在混合式應用程式中的策略性定位。 |
| 延展性  | 系統處理負載增加的能力。 |
| 可用性  | 混合式應用程式正常運作並執行作業的時間比例。 |
| 災害復原 | 混合式應用程式的復原能力。 |
| 管理能力 | 讓系統在生產環境中順利運作的作業流程。 |
| 安全性 | 保護混合式應用程式和資料，使其免於遭受威脅。 |

## <a name="placement"></a>放置

混合式應用程式原本就有放置考量，例如對資料中心的考量。

放置是定位元件的重要工作，藉此元件將可為混合式應用程式提供最佳服務。 根據定義，混合式應用程式會跨多個位置，例如從內部部署到雲端，以及在不同的雲端間。 您可以透過兩種方式將應用程式的元件放置在雲端：

- **垂直混合式應用程式**  
    應用程式元件會分散到各個位置。 每個個別元件可以有多個位於單一位置的執行個體。

- **水平混合式應用程式**  
    應用程式元件會分散到各個位置。 每個個別元件可以有多個跨多個位置的執行個體。

    有些元件可以辨識其位置，有些則完全無法辨識其位置和放置方式。 這種辨識力可透過抽象層來達成。 此層具有新式應用程式架構 (例如微服務)，可定義在跨雲端的節點上運作的應用程式元件如何藉由放置為應用程式提供服務。

### <a name="placement-checklist"></a>放置檢查清單

**確認必要的位置。** 請確定應用程式或其任何元件必須在特定雲端中運作，或需要該雲端的認證。 這可能包括您的公司或法律規定的主權需求。 此外，請確認特定位置或地區設定是否需要任何內部部署作業。

**確定連線相依性。** 必要的位置和其他因素可能會決定元件之間的連線相依性。 在放置元件時，請確認其間的通訊具有最佳連線能力和安全性。 選項包括 [*VPN*](https://docs.microsoft.com/azure/vpn-gateway/)、[*ExpressRoute*](https://docs.microsoft.com/azure/expressroute/) 和[*混合式連線*](https://docs.microsoft.com/azure/app-service/app-service-hybrid-connections)。

**評估平台功能。** 針對每個應用程式元件，請確認雲端上是否有應用程式元件所需的資源提供者，以及頻寬是否足以支應預期的輸送量和延遲需求。

**進行可攜性規劃。** 使用新式應用程式架構 (例如容器或微服務) 來規劃移動作業以及防止服務相依性。

**判斷資料主權需求。** 混合式應用程式的設計可支援資料隔離，例如在本機資料中心。 請檢查您的資源放置方式，以對此需求提供最高的支援性。

**進行延遲規劃。** 雲端間的作業可能會使應用程式元件之間出現實際的距離。 請確定因應任何延遲的需求。

**控制流量流程。** 在公用雲端中的前端存取個人識別資訊資料時，請控制尖峰使用量，並確保該資料的傳輸方式適當且安全無虞。

## <a name="scalability"></a>延展性

延展性是指系統對於應用程式負載增加的處理能力，此能力可能隨著其他因素和作用力而改變，且除了會影響應用程式的大小和範圍外，也會影響對象的大小。

如需此要素的核心討論，請參閱卓越架構五大要素中的[*延展性*](https://docs.microsoft.com/azure/architecture/guide/pillars#scalability)。

混合式應用程式的水準調整方法可讓您新增更多執行個體以符合需求，然後在使用頻率較低時加以停用。

在混合式案例中，當元件分散於各雲端時，要相應放大個別元件必須先做額外的考量。 要調整應用程式的某個部分，可能需要連帶調整其他部分。 例如，如果用戶端連線數目增加，但應用程式的 Web 服務未適當相應放大，則資料庫上的負載可能會使應用程式達到飽和。

有些應用程式元件可以線性方式相應放大，有些則有調整相依性，而使其可調整的程度受到限制。 例如，為應用程式元件位置提供混合式連線的 VPN 通道，在可調整的頻寬和延遲方面都有其限制。 如何調整應用程式的元件以確實符合這些需求呢？

### <a name="scalability-checklist"></a>延展性檢查清單

**確定調整臨界值。** 若要處理應用程式中的各種相依性，請確認應用程式元件在不同雲端中可獨立調整到何種程度，同時仍符合執行應用程式的需求。 混合式應用程式常需要調整應用程式中的特定區域，以處理某個與應用程式的其餘部分互動並造成影響的功能。 例如，當前端執行個體超出某個數量時，可能需要調整後端。

**定義調整排程。** 大部分的應用程式都有忙碌期間，因此您必須將其尖峰時間彙總到排程中，以協調出最佳調整程序。

**使用集中式監視系統。** 平台監視功能可以提供自動調整機制，但混合式應用程式需要可彙總系統健康情況和負載的集中式監視系統。 集中式監視系統可在某個位置開始調整某項資源，並在另一個位置調整相依的資源。 此外，中央監視系統可追蹤哪些雲端會自動調整資源，哪些雲端不會。

**利用自動調整功能 (如果適用)。** 如果自動調整功能是您架構的一部分，您可以設定臨界值，以定義應用程式元件在何時需要相應增加、相應放大、相應減少或相應縮小，藉以實作自動調整。 舉例來說，若用戶端連線在一個雲端中進行自動調整，以處理增加的容量，但同時使分散於不同雲端的其他應用程式相依性也進行調整，即為自動調整。 您必須確認這些相依元件是否有自動調整功能。

如果無法使用自動調整，請考慮執行指令碼和其他資源，以處理由集中式監視系統中的臨界值所觸發的手動調整。

**依位置判斷預期的負載。** 處理用戶端要求的混合式應用程式主要可能會依賴單一位置。 當用戶端要求的負載超過閾值時，您可以在不同的位置新增額外的資源，以分散輸入要求的負載。 請確定用戶端連線可以處理增加的負載，並確認是否有任何自動化程序可供用戶端連線處理負載。

## <a name="availability"></a>可用性

可用性是指系統正常運作並執行作業的時間。 可用性會以運作時間百分比來測量。 應用程式錯誤、基礎結構問題和系統負載全都有可能會降低可用性。

如需此要素的核心討論，請參閱卓越架構五大要素中的[*可用性*](/azure/architecture/framework/)。

### <a name="availability-checklist"></a>可用性檢查清單

**提供備援連線能力。** 使用混合式應用程式時，應用程式散佈所在的雲端之間必須可相互連線。 您可以選擇混合式連線的技術，因此除了您選擇的主要技術外，您也可以使用另一項技術來提供備援能力，以便在主要技術失敗時進行自動化容錯移轉。

**分類容錯網域。** 容錯應用程式需要多個容錯網域。 容錯網域有助於找出失敗點，例如，是內部部署的單一硬碟故障、機架頂端交換器中斷，還是整個資料中心都無法使用。 在混合式應用程式中，您可將位置分類為容錯網域。 可用性需求愈高，就愈有必要評估單一容錯網域的分類方式。

**分類升級網域。** 升級網域可用來確保應用程式元件的執行個體在相同元件的其他執行個體進行更新或功能升級時，仍可供使用。 和容錯網域一樣，升級網域也可依其放置位置來分類。 您必須先判斷應用程式元件是否可直接在某個位置升級而無須先在另一個位置升級，或是否需要進行其他網域設定。 單一位置本身可以有多個升級網域。

**追蹤執行個體和可用性。** 高可用性應用程式元件可透過負載平衡和同步資料複寫來啟用。 您必須確認在服務中斷之前最多可以有多少個離線的執行個體。

**實作自我修復。** 有問題導致應用程式可用性中斷時，監視系統的偵測可能會起始對應用程式的自我修復活動，例如清空失敗的執行個體並重新加以部署。 這很可能需要中央監視解決方案，並且整合混合式持續整合和持續傳遞 (CI/CD) 管線。 應用程式可與監視系統整合，以找出可能需要重新部署應用程式元件的問題。 監視系統也可觸發混合式 CI/CD 以重新部署應用程式元件，甚或位於相同或其他位置中的任何其他相依元件。

**維護服務等級協定 (SLA)。** 在任何合約中，要讓您為客戶提供的服務和應用程式保有連線能力，可用性都是關鍵要素。 您的混合式應用程式所依賴的每個位置都可能有其本身的 SLA。 這些不同的 SLA 可能會影響到您混合式應用程式的整體 SLA。

## <a name="resiliency"></a>災害復原

「復原」是指混合式應用程式和系統從失敗中復原並繼續運作的能力。 災害復原的目標是使應用程式在發生失敗後，能夠恢復到完全正常運作的狀態。 復原策略包括備份、複寫和災害復原等解決方案。

如需此要素的核心討論，請參閱卓越架構五大要素中的[*復原*](https://docs.microsoft.com/azure/architecture/guide/pillars#resiliency)。

### <a name="resiliency-checklist"></a>復原檢查清單

**找出災害復原相依性。** 要進行一個雲端中的災害復原，可能需要變更另一個雲端中的應用程式元件。 如果一個雲端中的一或多個元件容錯移轉至另一個位置 (在相同的雲端或另一個雲端中)，您必須使相依元件能夠辨識這些變更。 其中也包括連線相依性。 若要有復原能力，每個雲端都必須要有全面測試過的應用程式復原計畫。

**建立復原流程。** 有效的復原流程設計已評估應用程式元件是否有能力處理緩衝區、重試作業、重試失敗的資料傳輸，並視需要切換回不同的服務或工作流程。 您必須決定要使用何種備份機制、其還原程序涉及哪些因素，及其測試頻率。 您也應決定增量和完整備份的頻率。

**測試部分復原。** 應用程式局部的部分復原可對使用者再次擔保完整的可用性。 這部分的計畫應確保部分還原沒有任何副作用，例如，備份和還原服務會與應用程式互動，並在進行備份之前依正常程序加以關閉。

**決定災害復原調查人員並指派職責。** 復原計畫應在可備份和還原的項目以外，連帶說明哪些人和哪些角色可起始備份和復原動作。

**比較自我修復臨界值與災害復原。** 確認應用程式起始自動復原的自我修復能力，以及將應用程式的自我修復視為失敗或成功所需的時間。 請決定每個雲端的臨界值。

**確認復原功能的可用性。** 對每個位置確認復原功能和能力的可用性。 如果某個位置未提供必要的能力，請考慮將該位置整合到可提供復原功能的集中式服務中。

**確認停機時間。** 確認因應用程式整體維護和應用程式元件個別維護而造成的預期停機時間。

**記錄疑難排解程序。** 定義重新部署資源和應用程式元件的疑難排解程序。

## <a name="manageability"></a>管理能力

在設計架構時，您管理混合式應用程式的方式是非常重要的考量。 妥善管理的混合式應用程式可提供程式碼形式的的基礎結構，讓您可在一般開發管線中整合一致的應用程式程式碼。 藉由對基礎結構的變更執行一致的全系統和個別測試，當變更通過測試時，您可以確保整合的部署允許將這些變更合併到原始程式碼中。

如需此要素的核心討論，請參閱卓越架構五大要素中的 [*DevOps*](/azure/architecture/framework/#devops)。

### <a name="manageability-checklist"></a>管理性檢查清單

**實作監視。** 使用跨雲端散佈之應用程式元件的集中式監視系統，提供其健康情況和效能的彙總檢視。 此系統會同時監視應用程式元件和相關的平台功能。

請確認需要監視應用程式的哪些部分。

**協調原則。** 混合式應用程式跨及的每個位置都可以有其本身的原則，其中涵蓋允許的資源類型、命名慣例、標記和其他準則。

**定義和使用角色。** 身為資料庫管理員，您必須為需要存取應用程式資源的不同角色 (例如應用程式擁有者、資料庫管理員和使用者) 指定其所需的權限。 這些權限必須設定在資源上和應用程式內。 角色型存取控制 (RBAC) 系統可讓您在應用程式資源上設定這些權限。 當所有資源都部署在單一雲端時，這些存取權限會很難處理，但在資源分散於不同的雲端時將更需多加留意。 在某個雲端中設定的資源權限，不會套用至另一個雲端中設定的資源。

**使用 CI/CD 管線。** 持續整合和持續開發 (CI/CD) 管線可提供一致的程序讓您撰寫和部署跨雲端的應用程式，並提供其基礎結構和應用程式的品質保證。 此管線可讓基礎結構和應用程式在一個雲端上進行測試，然後部署在另一個雲端上。 此管線甚至可讓您將混合式應用程式的特定元件部署到一個雲端，並將其他元件部署到另一個雲端，而構成混合式應用程式部署的基礎。 在處理相依性應用程式元件在安裝期間對彼此的相依性時 (例如 Web 應用程式需要資料庫的連接字串)，CI/CD 系統是不可或缺的。

**管理生命週期。** 由於混合式應用程式的資源可跨多個位置，因此必須將每個單一位置的生命週期管理功能彙總成單一生命週期管理單元。 請考量其建立、更新和刪除方式。

**檢查疑難排解策略。** 相較於在單一雲端中執行的應用程式，對混合式應用程式進行疑難排解時所涉及的應用程式元件相對較多。 除了雲端之間的連線，應用程式都會在兩個平台上執行，而不是一個。 對混合式應用程式進行疑難排解的重要工作之一，是檢查應用程式元件彙總的健康情況和效能監視。

## <a name="security"></a>安全性

安全性是任何雲端應用程式的主要考量之一，對混合式雲端應用程式而言更是重要。

如需此要素的核心討論，請參閱卓越架構五大要素中的[*安全性*](https://docs.microsoft.com/azure/architecture/guide/pillars#security)。

### <a name="security-checklist"></a>安全性檢查清單

**假想缺口。** 如果應用程式的某個部分遭到入侵，請確定有現成的解決方案可將缺口的擴散性降到最低，且不僅是在相同位置內，各個位置也是如此。

**監視允許的網路存取。** 決定應用程式的網路存取原則，例如只從特定子網路存取應用程式，以及在元件之間僅允許應用程式正常運作所需的基本連接埠和通訊協定。

**採用健全的驗證。** 健全的驗證配置對應用程式的安全性而言非常重要。 請考慮使用可提供單一登入功能的同盟識別提供者，並採用下列一或多項配置：使用者名稱和密碼登入、公開和私密金鑰、雙因素或多重要素驗證，以及信任的安全性群組。 請指定適當的資源來儲存機密資料，且除了憑證類型及其需求外，請為應用程式驗證指定其他秘密。

**使用加密。** 識別應用程式的哪些區域應使用加密，例如，用於資料儲存或用戶端通訊和存取。

**使用安全通道。** 雲端間必須要有安全通道，才能提供安全性和驗證檢查、即時保護、隔離，和其他跨雲端的服務。

**定義和使用角色。** 對雲端間的資源設定和單一身分識別存取實作適當角色。 確認應用程式及其平台資源的角色型存取控制 (RBAC) 需求。

**稽核您的系統。** 系統監視可以記錄和彙總來自應用程式元件和相關雲端平台作業的資料。

## <a name="summary"></a>摘要

本文提供在撰寫和設計混合式應用程式期間必須考量的重要事項檢查清單。 在部署應用程式之前先檢閱這些要素，可防止您在生產環境中斷運作時遇到這些問題，甚至還須重新審視您的設計。

您可能會覺得這項前置工作很耗時，但如果您根據這些要素來設計應用程式，其效益將輕易彰顯。

## <a name="next-steps"></a>後續步驟

如需詳細資訊，請參閱下列資源：

- [混合式雲端](https://azure.microsoft.com/overview/hybrid-cloud/)
- [混合式雲端應用程式](https://azure.microsoft.com/solutions/hybrid-cloud-app/)
- [針對雲端一致性開發 Azure Resource Manager 範本](https://aka.ms/consistency)
